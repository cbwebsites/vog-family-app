<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOG Family DB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .photo-preview {
            max-height: 200px;
            object-fit: cover;
        }
        .member-item {
            transition: all 0.3s ease;
        }
        .member-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .family-card {
            transition: all 0.3s ease;
        }
        .family-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .profile-modal {
            transition: opacity 0.3s ease;
        }
        .profile-modal-content {
            transition: transform 0.3s ease;
        }
        .photo-6x4 {
            aspect-ratio: 6/4;
            object-fit: cover;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-blue-600 text-white shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-users text-xl"></i>
                    <h1 class="text-xl font-bold">VOG Family DB</h1>
                </div>
                <div class="flex space-x-6">
                    <a href="#" id="dashboard-link" class="hover:text-blue-200 font-medium flex items-center space-x-1 border-b-2 border-white">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" id="add-family-link" class="hover:text-blue-200 font-medium flex items-center space-x-1">
                        <i class="fas fa-plus-circle"></i>
                        <span>Add Family</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Dashboard Section -->
        <div id="dashboard-section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-blue-700">Family Dashboard</h2>
                <div class="relative">
                    <input type="text" id="search-families" placeholder="Search families..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
            </div>
            <div id="families-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Family cards will be populated here -->
            </div>
        </div>
        
        <!-- Add/Edit Family Form -->
        <div id="add-family-section" class="bg-white rounded-lg shadow-md p-6 hidden">
            <h2 id="form-title" class="text-2xl font-bold text-blue-700 mb-6">Add New Family</h2>
            
            <form id="family-form" class="space-y-6">
                <!-- Family Information -->
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-800 mb-4">Family Information</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="family-name" class="block text-sm font-medium text-gray-700 mb-1">Family Name *</label>
                            <input type="text" id="family-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label>
                            <input type="tel" id="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label for="address" class="block text-sm font-medium text-gray-700 mb-1">Address *</label>
                        <textarea id="address" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                </div>
                
                <!-- Family Photo -->
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-800 mb-4">Family Photo</h3>
                    
                    <div class="flex flex-col items-center">
                        <div class="border-2 border-dashed border-blue-300 rounded-lg p-6 text-center w-full max-w-md">
                            <i class="fas fa-cloud-upload-alt text-blue-400 text-4xl mb-2"></i>
                            <p class="text-gray-600 mb-4">Upload a family group photo (6x4 aspect ratio)</p>
                            <input type="file" id="family-photo" accept="image/*" class="hidden">
                            <button type="button" id="upload-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition duration-200">Choose File</button>
                        </div>
                        <div id="photo-preview" class="mt-4 hidden">
                            <img src="" alt="Family Photo Preview" class="photo-preview photo-6x4 rounded-lg shadow-md w-full max-w-md">
                        </div>
                    </div>
                </div>
                
                <!-- Family Members -->
                <div class="bg-blue-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-blue-800">Family Members</h3>
                        <button type="button" id="add-member-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md text-sm flex items-center space-x-1">
                            <i class="fas fa-plus"></i>
                            <span>Add Member</span>
                        </button>
                    </div>
                    
                    <div id="members-container" class="space-y-4">
                        <!-- Member fields will be added here dynamically -->
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="cancel-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition duration-200">Cancel</button>
                    <button type="button" id="reset-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition duration-200">Reset Form</button>
                    <button type="submit" id="submit-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition duration-200 flex items-center space-x-2">
                        <i class="fas fa-save"></i>
                        <span>Save Family</span>
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                    <i class="fas fa-check text-green-600 text-xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mt-3" id="success-title">Family Added Successfully!</h3>
                <p class="text-sm text-gray-500 mt-2" id="success-message">The family has been added to the database.</p>
                <div class="mt-4">
                    <button id="modal-ok-btn" class="inline-flex justify-center px-4 py-2 text-sm font-medium text-blue-900 bg-blue-100 border border-transparent rounded-md hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile View Modal -->
    <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50 profile-modal">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 profile-modal-content transform scale-95">
            <div class="relative">
                <!-- Close Button -->
                <button id="close-profile" class="absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 z-10 hover:bg-opacity-70 transition duration-200">
                    <i class="fas fa-times text-lg"></i>
                </button>
                
                <!-- Navigation Arrows -->
                <button id="prev-family" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white bg-black bg-opacity-50 rounded-full p-3 z-10 hover:bg-opacity-70 transition duration-200">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button id="next-family" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white bg-black bg-opacity-50 rounded-full p-3 z-10 hover:bg-opacity-70 transition duration-200">
                    <i class="fas fa-chevron-right"></i>
                </button>
                
                <!-- Profile Content -->
                <div id="profile-content" class="flex flex-col md:flex-row">
                    <!-- Photo Section -->
                    <div class="md:w-1/2 bg-gray-100 rounded-t-xl md:rounded-l-xl md:rounded-tr-none p-6 flex items-center justify-center">
                        <div id="profile-photo-container" class="w-full flex items-center justify-center">
                            <!-- Photo will be inserted here -->
                        </div>
                    </div>
                    
                    <!-- Details Section -->
                    <div class="md:w-1/2 p-6">
                        <h2 id="profile-family-name" class="text-2xl font-bold text-blue-700 mb-4"></h2>
                        
                        <div class="space-y-4">
                            <div class="flex items-start">
                                <i class="fas fa-phone-alt text-blue-500 mt-1 mr-3"></i>
                                <div>
                                    <p class="text-sm text-gray-500">Phone</p>
                                    <p id="profile-phone" class="font-medium"></p>
                                </div>
                            </div>
                            
                            <div class="flex items-start">
                                <i class="fas fa-map-marker-alt text-blue-500 mt-1 mr-3"></i>
                                <div>
                                    <p class="text-sm text-gray-500">Address</p>
                                    <p id="profile-address" class="font-medium"></p>
                                </div>
                            </div>
                            
                            <div class="pt-4 border-t border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-800 mb-3">Family Members</h3>
                                <div id="profile-members" class="space-y-3">
                                    <!-- Members will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data for demonstration
        let families = JSON.parse(localStorage.getItem('families')) || [];
        let memberCount = 0;
        let isEditing = false;
        let currentEditId = null;
        let currentProfileIndex = 0;

        // DOM Elements
        const dashboardSection = document.getElementById('dashboard-section');
        const addFamilySection = document.getElementById('add-family-section');
        const dashboardLink = document.getElementById('dashboard-link');
        const addFamilyLink = document.getElementById('add-family-link');
        const familyForm = document.getElementById('family-form');
        const membersContainer = document.getElementById('members-container');
        const addMemberBtn = document.getElementById('add-member-btn');
        const resetBtn = document.getElementById('reset-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const uploadBtn = document.getElementById('upload-btn');
        const familyPhotoInput = document.getElementById('family-photo');
        const photoPreview = document.getElementById('photo-preview');
        const successModal = document.getElementById('success-modal');
        const modalOkBtn = document.getElementById('modal-ok-btn');
        const familiesList = document.getElementById('families-list');
        const formTitle = document.getElementById('form-title');
        const submitBtn = document.getElementById('submit-btn');
        const successTitle = document.getElementById('success-title');
        const successMessage = document.getElementById('success-message');
        const profileModal = document.getElementById('profile-modal');
        const closeProfile = document.getElementById('close-profile');
        const prevFamily = document.getElementById('prev-family');
        const nextFamily = document.getElementById('next-family');
        const profileContent = document.getElementById('profile-content');
        const profileFamilyName = document.getElementById('profile-family-name');
        const profilePhone = document.getElementById('profile-phone');
        const profileAddress = document.getElementById('profile-address');
        const profileMembers = document.getElementById('profile-members');
        const profilePhotoContainer = document.getElementById('profile-photo-container');
        const searchFamilies = document.getElementById('search-families');

        // Event Listeners
        dashboardLink.addEventListener('click', showDashboard);
        addFamilyLink.addEventListener('click', showAddFamily);
        addMemberBtn.addEventListener('click', addMemberField);
        resetBtn.addEventListener('click', resetForm);
        cancelBtn.addEventListener('click', cancelForm);
        uploadBtn.addEventListener('click', () => familyPhotoInput.click());
        familyPhotoInput.addEventListener('change', handlePhotoUpload);
        familyForm.addEventListener('submit', handleFormSubmit);
        modalOkBtn.addEventListener('click', () => {
            successModal.classList.add('hidden');
            if (!isEditing) showDashboard();
        });
        closeProfile.addEventListener('click', () => profileModal.classList.add('hidden'));
        prevFamily.addEventListener('click', showPreviousFamily);
        nextFamily.addEventListener('click', showNextFamily);
        searchFamilies.addEventListener('input', filterFamilies);

        // Keyboard event listener for arrow navigation
        document.addEventListener('keydown', handleKeyboardNavigation);

        // Functions
        function showDashboard(e) {
            if (e) e.preventDefault();
            dashboardSection.classList.remove('hidden');
            addFamilySection.classList.add('hidden');
            updateDashboardLink();
            renderFamilies();
        }

        function showAddFamily(e) {
            if (e) e.preventDefault();
            isEditing = false;
            currentEditId = null;
            formTitle.textContent = "Add New Family";
            submitBtn.innerHTML = '<i class="fas fa-save"></i><span>Save Family</span>';
            dashboardSection.classList.add('hidden');
            addFamilySection.classList.remove('hidden');
            updateAddFamilyLink();
            resetForm();
        }

        function updateDashboardLink() {
            dashboardLink.classList.add('border-b-2', 'border-white');
            addFamilyLink.classList.remove('border-b-2', 'border-white');
        }

        function updateAddFamilyLink() {
            addFamilyLink.classList.add('border-b-2', 'border-white');
            dashboardLink.classList.remove('border-b-2', 'border-white');
        }

        function addMemberField(memberData = {}) {
            memberCount++;
            const memberDiv = document.createElement('div');
            memberDiv.className = 'member-item bg-white p-4 rounded-lg border border-blue-200';
            memberDiv.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <h4 class="font-medium text-blue-700">Member ${memberCount}</h4>
                    <button type="button" class="text-red-500 hover:text-red-700 remove-member">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                        <input type="text" value="${memberData.name || ''}" required class="member-name w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth *</label>
                        <input type="date" value="${memberData.dob || ''}" required class="member-dob w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                        <select class="member-gender w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select</option>
                            <option value="Male" ${memberData.gender === 'Male' ? 'selected' : ''}>Male</option>
                            <option value="Female" ${memberData.gender === 'Female' ? 'selected' : ''}>Female</option>
                            <option value="Other" ${memberData.gender === 'Other' ? 'selected' : ''}>Other</option>
                        </select>
                    </div>
                    <div class="md:col-span-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Relation to Head</label>
                        <select class="member-relation w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Relation</option>
                            <option value="Head" ${memberData.relation === 'Head' ? 'selected' : ''}>Head of Family</option>
                            <option value="Spouse" ${memberData.relation === 'Spouse' ? 'selected' : ''}>Spouse</option>
                            <option value="Child" ${memberData.relation === 'Child' ? 'selected' : ''}>Child</option>
                            <option value="Parent" ${memberData.relation === 'Parent' ? 'selected' : ''}>Parent</option>
                            <option value="Sibling" ${memberData.relation === 'Sibling' ? 'selected' : ''}>Sibling</option>
                            <option value="Grandchild" ${memberData.relation === 'Grandchild' ? 'selected' : ''}>Grandchild</option>
                            <option value="Other" ${memberData.relation === 'Other' ? 'selected' : ''}>Other</option>
                        </select>
                    </div>
                </div>
            `;
            membersContainer.appendChild(memberDiv);
            
            // Add event listener to remove button
            const removeBtn = memberDiv.querySelector('.remove-member');
            removeBtn.addEventListener('click', () => {
                memberDiv.remove();
            });
        }

        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = photoPreview.querySelector('img');
                    img.src = event.target.result;
                    photoPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function resetForm() {
            familyForm.reset();
            membersContainer.innerHTML = '';
            memberCount = 0;
            photoPreview.classList.add('hidden');
            // Add one empty member field by default
            addMemberField();
        }

        function cancelForm() {
            if (isEditing) {
                showDashboard();
            } else {
                resetForm();
            }
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Get family data
            const familyName = document.getElementById('family-name').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            
            // Get members data
            const members = [];
            const memberElements = document.querySelectorAll('.member-item');
            memberElements.forEach(memberEl => {
                const name = memberEl.querySelector('.member-name').value;
                const dob = memberEl.querySelector('.member-dob').value;
                const gender = memberEl.querySelector('.member-gender').value;
                const relation = memberEl.querySelector('.member-relation').value;
                if (name && dob) {
                    members.push({ name, dob, gender, relation });
                }
            });
            
            // Get photo data
            let photoData = null;
            if (familyPhotoInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    photoData = event.target.result;
                    saveFamily(familyName, phone, address, members, photoData);
                };
                reader.readAsDataURL(familyPhotoInput.files[0]);
            } else {
                // If editing and no new photo, keep the existing one
                if (isEditing && currentEditId) {
                    const existingFamily = families.find(f => f.id === currentEditId);
                    photoData = existingFamily ? existingFamily.photo : null;
                }
                saveFamily(familyName, phone, address, members, photoData);
            }
        }

        function saveFamily(familyName, phone, address, members, photoData) {
            if (isEditing && currentEditId) {
                // Update existing family
                const index = families.findIndex(f => f.id === currentEditId);
                if (index !== -1) {
                    families[index] = {
                        ...families[index],
                        familyName,
                        phone,
                        address,
                        members,
                        photo: photoData || families[index].photo,
                        updatedAt: new Date().toISOString()
                    };
                    
                    successTitle.textContent = "Family Updated Successfully!";
                    successMessage.textContent = "The family information has been updated.";
                }
            } else {
                // Add new family
                const newFamily = {
                    id: Date.now(),
                    familyName,
                    phone,
                    address,
                    members,
                    photo: photoData,
                    createdAt: new Date().toISOString()
                };
                
                families.push(newFamily);
                successTitle.textContent = "Family Added Successfully!";
                successMessage.textContent = "The family has been added to the database.";
            }
            
            localStorage.setItem('families', JSON.stringify(families));
            
            // Show success modal
            successModal.classList.remove('hidden');
            
            // Reset form and return to dashboard
            isEditing = false;
            currentEditId = null;
        }

        function renderFamilies(filteredFamilies = null) {
            const familiesToRender = filteredFamilies || families;
            familiesList.innerHTML = '';
            
            if (familiesToRender.length === 0) {
                familiesList.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-users text-5xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-medium text-gray-500">No families found</h3>
                        <p class="text-gray-400 mt-2">${filteredFamilies ? 'Try a different search term' : 'Add your first family to get started'}</p>
                    </div>
                `;
                return;
            }
            
            familiesToRender.forEach(family => {
                const familyCard = document.createElement('div');
                familyCard.className = 'family-card bg-white rounded-lg shadow-md overflow-hidden';
                
                let photoSection = '';
                if (family.photo) {
                    photoSection = `<img src="${family.photo}" alt="${family.familyName}" class="w-full h-40 photo-6x4 object-cover">`;
                } else {
                    photoSection = `
                        <div class="w-full h-40 bg-blue-100 flex items-center justify-center photo-6x4">
                            <i class="fas fa-users text-4xl text-blue-300"></i>
                        </div>
                    `;
                }
                
                familyCard.innerHTML = `
                    ${photoSection}
                    <div class="p-3">
                        <h3 class="text-lg font-bold text-blue-700 mb-1 truncate">${family.familyName}</h3>
                        <p class="text-gray-600 text-sm mb-1 flex items-center">
                            <i class="fas fa-phone-alt text-blue-500 mr-1 text-xs"></i>
                            <span class="truncate">${family.phone}</span>
                        </p>
                        <p class="text-gray-600 text-sm mb-2 flex items-start">
                            <i class="fas fa-map-marker-alt text-blue-500 mr-1 mt-0.5 text-xs"></i>
                            <span class="flex-1 line-clamp-2">${family.address}</span>
                        </p>
                        <div class="border-t border-gray-200 pt-2">
                            <h4 class="font-medium text-gray-700 text-sm mb-1">Family Members (${family.members.length})</h4>
                            <ul class="text-xs text-gray-600 space-y-1">
                                ${family.members.slice(0, 2).map(member => `
                                    <li class="flex justify-between">
                                        <span class="truncate">${member.name}</span>
                                        <span class="text-gray-500 ml-2">${formatDate(member.dob)}</span>
                                    </li>
                                `).join('')}
                                ${family.members.length > 2 ? `<li class="text-blue-500 text-xs">+ ${family.members.length - 2} more</li>` : ''}
                            </ul>
                        </div>
                        <div class="flex justify-between mt-3 pt-2 border-t border-gray-200">
                            <button class="view-family text-blue-600 hover:text-blue-800 flex items-center space-x-1 text-xs" data-id="${family.id}">
                                <i class="fas fa-eye"></i>
                                <span>View</span>
                            </button>
                            <button class="edit-family text-green-600 hover:text-green-800 flex items-center space-x-1 text-xs" data-id="${family.id}">
                                <i class="fas fa-edit"></i>
                                <span>Edit</span>
                            </button>
                        </div>
                    </div>
                `;
                
                familiesList.appendChild(familyCard);
            });
            
            // Add event listeners to view and edit buttons
            document.querySelectorAll('.view-family').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const familyId = parseInt(e.currentTarget.getAttribute('data-id'));
                    showFamilyProfile(familyId);
                });
            });
            
            document.querySelectorAll('.edit-family').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const familyId = parseInt(e.currentTarget.getAttribute('data-id'));
                    editFamily(familyId);
                });
            });
        }

        function showFamilyProfile(familyId) {
            const familyIndex = families.findIndex(f => f.id === familyId);
            if (familyIndex === -1) return;
            
            currentProfileIndex = familyIndex;
            displayFamilyProfile(families[familyIndex]);
            profileModal.classList.remove('hidden');
        }

        function displayFamilyProfile(family) {
            profileFamilyName.textContent = family.familyName;
            profilePhone.textContent = family.phone;
            profileAddress.textContent = family.address;
            
            // Display photo
            if (family.photo) {
                profilePhotoContainer.innerHTML = `<img src="${family.photo}" alt="${family.familyName}" class="w-full max-w-md photo-6x4 object-cover rounded-lg">`;
            } else {
                profilePhotoContainer.innerHTML = `
                    <div class="w-full max-w-md h-64 bg-blue-100 rounded-lg flex flex-col items-center justify-center photo-6x4">
                        <i class="fas fa-users text-6xl text-blue-300 mb-4"></i>
                        <p class="text-blue-500">No photo available</p>
                    </div>
                `;
            }
            
            // Display members
            profileMembers.innerHTML = '';
            family.members.forEach(member => {
                const memberElement = document.createElement('div');
                memberElement.className = 'flex justify-between items-center bg-blue-50 p-3 rounded-lg';
                memberElement.innerHTML = `
                    <div>
                        <p class="font-medium text-gray-800">${member.name}</p>
                        <div class="flex text-sm text-gray-600 mt-1">
                            <span class="mr-3">${formatDate(member.dob)}</span>
                            ${member.gender ? `<span class="mr-3">${member.gender}</span>` : ''}
                            ${member.relation ? `<span>${getRelationDisplay(member.relation)}</span>` : ''}
                        </div>
                    </div>
                    <div class="text-blue-500">
                        <i class="fas fa-user"></i>
                    </div>
                `;
                profileMembers.appendChild(memberElement);
            });
        }

        function getRelationDisplay(relation) {
            const relationMap = {
                'Head': 'Head of Family',
                'Spouse': 'Spouse',
                'Child': 'Child',
                'Parent': 'Parent',
                'Sibling': 'Sibling',
                'Grandchild': 'Grandchild',
                'Other': 'Other Relative'
            };
            return relationMap[relation] || relation;
        }

        function showPreviousFamily() {
            if (families.length === 0) return;
            currentProfileIndex = (currentProfileIndex - 1 + families.length) % families.length;
            displayFamilyProfile(families[currentProfileIndex]);
        }

        function showNextFamily() {
            if (families.length === 0) return;
            currentProfileIndex = (currentProfileIndex + 1) % families.length;
            displayFamilyProfile(families[currentProfileIndex]);
        }

        function handleKeyboardNavigation(e) {
            // Only handle keyboard events when profile modal is open
            if (profileModal.classList.contains('hidden')) return;
            
            if (e.key === 'ArrowLeft') {
                showPreviousFamily();
            } else if (e.key === 'ArrowRight') {
                showNextFamily();
            } else if (e.key === 'Escape') {
                profileModal.classList.add('hidden');
            }
        }

        function editFamily(familyId) {
            const family = families.find(f => f.id === familyId);
            if (!family) return;
            
            isEditing = true;
            currentEditId = familyId;
            formTitle.textContent = "Edit Family";
            submitBtn.innerHTML = '<i class="fas fa-save"></i><span>Update Family</span>';
            
            // Populate form with family data
            document.getElementById('family-name').value = family.familyName;
            document.getElementById('phone').value = family.phone;
            document.getElementById('address').value = family.address;
            
            // Clear members container and add existing members
            membersContainer.innerHTML = '';
            memberCount = 0;
            family.members.forEach(member => {
                addMemberField(member);
            });
            
            // Display existing photo if available
            if (family.photo) {
                const img = photoPreview.querySelector('img');
                img.src = family.photo;
                photoPreview.classList.remove('hidden');
            } else {
                photoPreview.classList.add('hidden');
            }
            
            // Show the form section
            dashboardSection.classList.add('hidden');
            addFamilySection.classList.remove('hidden');
            updateAddFamilyLink();
        }

        function filterFamilies() {
            const searchTerm = searchFamilies.value.toLowerCase();
            if (searchTerm === '') {
                renderFamilies();
                return;
            }
            
            const filteredFamilies = families.filter(family => 
                family.familyName.toLowerCase().includes(searchTerm) ||
                family.phone.includes(searchTerm) ||
                family.address.toLowerCase().includes(searchTerm) ||
                family.members.some(member => member.name.toLowerCase().includes(searchTerm))
            );
            
            renderFamilies(filteredFamilies);
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Initialize with one member field and render families
        addMemberField();
        renderFamilies();
    </script>
</body>
</html>